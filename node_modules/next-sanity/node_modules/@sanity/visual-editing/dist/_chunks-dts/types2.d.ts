import { it as VisualEditingNode } from "./types.js";
import * as _sanity_mutate__unstable_machine296 from "@sanity/mutate/_unstable_machine";
import { DocumentMutatorMachineInput, createSharedListener } from "@sanity/mutate/_unstable_machine";
import * as _sanity_client764 from "@sanity/client";
import { SanityClient, SanityDocument } from "@sanity/client";
import * as xstate947 from "xstate";
import { ActorRefFrom } from "xstate";
import * as rxjs8 from "rxjs";
import { Mutation, NodePatchList } from "@sanity/mutate";
declare const createDocumentMutator: (comlink: VisualEditingNode) => xstate947.StateMachine<{
  client: SanityClient;
  sharedListener?: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
  id: string;
  cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
  remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
  local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
  mutationEvents: _sanity_client764.MutationEvent[];
  stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
  stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
  error: unknown;
  fetchRemoteSnapshotAttempts: number;
  submitTransactionsAttempts: number;
}, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
  type: "error";
} | {
  type: "retry";
} | {
  type: "connect";
} | {
  type: "reconnect";
} | {
  type: "welcome";
} | {
  type: "mutate";
  mutations: _sanity_mutate__unstable_machine296.Mutation[];
} | {
  type: "submit";
} | {
  type: "xstate.done.actor.getDocument";
  output: _sanity_client764.SanityDocument<DocumentType>;
} | {
  type: "xstate.done.actor.submitTransactions";
  output: undefined;
}, {
  [x: string]: xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
    client: SanityClient;
    id: string;
  }, xstate947.EventObject>> | xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void, {
    client: SanityClient;
    transactions: _sanity_mutate__unstable_machine296.Transaction[];
  }, xstate947.EventObject>> | xstate947.ActorRefFromLogic<xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
    listener: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
    id: string;
  }, xstate947.EventObject>> | undefined;
  getDocument?: xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
    client: SanityClient;
    id: string;
  }, xstate947.EventObject>> | undefined;
  submitTransactions?: xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void, {
    client: SanityClient;
    transactions: _sanity_mutate__unstable_machine296.Transaction[];
  }, xstate947.EventObject>> | undefined;
}, xstate947.Values<{
  'fetch remote snapshot': {
    src: "fetch remote snapshot";
    logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
      client: SanityClient;
      id: string;
    }, xstate947.EventObject>;
    id: "getDocument";
  };
  'submit mutations as transactions': {
    src: "submit mutations as transactions";
    logic: xstate947.PromiseActorLogic<void, {
      client: SanityClient;
      transactions: _sanity_mutate__unstable_machine296.Transaction[];
    }, xstate947.EventObject>;
    id: "submitTransactions";
  };
  'server-sent events': {
    src: "server-sent events";
    logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
      listener: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
      id: string;
    }, xstate947.EventObject>;
    id: string | undefined;
  };
}>, xstate947.Values<{
  'assign error to context': {
    type: "assign error to context";
    params: xstate947.NonReducibleUnknown;
  };
  'clear error from context': {
    type: "clear error from context";
    params: xstate947.NonReducibleUnknown;
  };
  'connect to server-sent events': {
    type: "connect to server-sent events";
    params: xstate947.NonReducibleUnknown;
  };
  'listen to server-sent events': {
    type: "listen to server-sent events";
    params: xstate947.NonReducibleUnknown;
  };
  'stop listening to server-sent events': {
    type: "stop listening to server-sent events";
    params: xstate947.NonReducibleUnknown;
  };
  'buffer remote mutation events': {
    type: "buffer remote mutation events";
    params: xstate947.NonReducibleUnknown;
  };
  'restore stashed changes': {
    type: "restore stashed changes";
    params: xstate947.NonReducibleUnknown;
  };
  'rebase fetched remote snapshot': {
    type: "rebase fetched remote snapshot";
    params: xstate947.NonReducibleUnknown;
  };
  'apply mendoza patch': {
    type: "apply mendoza patch";
    params: xstate947.NonReducibleUnknown;
  };
  'increment fetch attempts': {
    type: "increment fetch attempts";
    params: xstate947.NonReducibleUnknown;
  };
  'reset fetch attempts': {
    type: "reset fetch attempts";
    params: xstate947.NonReducibleUnknown;
  };
  'increment submit attempts': {
    type: "increment submit attempts";
    params: xstate947.NonReducibleUnknown;
  };
  'reset submit attempts': {
    type: "reset submit attempts";
    params: xstate947.NonReducibleUnknown;
  };
  'stage mutation': {
    type: "stage mutation";
    params: xstate947.NonReducibleUnknown;
  };
  'stash mutation': {
    type: "stash mutation";
    params: xstate947.NonReducibleUnknown;
  };
  'rebase local snapshot': {
    type: "rebase local snapshot";
    params: xstate947.NonReducibleUnknown;
  };
  'send pristine event to parent': {
    type: "send pristine event to parent";
    params: xstate947.NonReducibleUnknown;
  };
  'send sync event to parent': {
    type: "send sync event to parent";
    params: xstate947.NonReducibleUnknown;
  };
  'send mutation event to parent': {
    type: "send mutation event to parent";
    params: xstate947.NonReducibleUnknown;
  };
}>, never, "fetchRemoteSnapshotTimeout" | "submitTransactionsTimeout", "disconnected" | "connecting" | "reconnecting" | "connectFailure" | {
  connected: "loading" | "loadFailure" | {
    loaded: "pristine" | "dirty" | "submitting" | "submitFailure";
  };
}, "error" | "busy" | "ready", _sanity_mutate__unstable_machine296.DocumentMutatorMachineInput, xstate947.NonReducibleUnknown, xstate947.EventObject, xstate947.MetaObject, {
  readonly id: "document-mutator";
  readonly context: ({
    input
  }: {
    spawn: {
      <TSrc extends "fetch remote snapshot" | "submit mutations as transactions" | "server-sent events">(logic: TSrc, ...[options]: ({
        src: "fetch remote snapshot";
        logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
          client: SanityClient;
          id: string;
        }, xstate947.EventObject>;
        id: "getDocument";
      } extends infer T ? T extends {
        src: "fetch remote snapshot";
        logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
          client: SanityClient;
          id: string;
        }, xstate947.EventObject>;
        id: "getDocument";
      } ? T extends {
        src: TSrc;
      } ? xstate947.ConditionalRequired<[options?: ({
        id?: T["id"] | undefined;
        systemId?: string;
        input?: xstate947.InputFrom<T["logic"]> | undefined;
        syncSnapshot?: boolean;
      } & { [K in xstate947.RequiredActorOptions<T>]: unknown }) | undefined], xstate947.IsNotNever<xstate947.RequiredActorOptions<T>>> : never : never : never) | ({
        src: "submit mutations as transactions";
        logic: xstate947.PromiseActorLogic<void, {
          client: SanityClient;
          transactions: _sanity_mutate__unstable_machine296.Transaction[];
        }, xstate947.EventObject>;
        id: "submitTransactions";
      } extends infer T_1 ? T_1 extends {
        src: "submit mutations as transactions";
        logic: xstate947.PromiseActorLogic<void, {
          client: SanityClient;
          transactions: _sanity_mutate__unstable_machine296.Transaction[];
        }, xstate947.EventObject>;
        id: "submitTransactions";
      } ? T_1 extends {
        src: TSrc;
      } ? xstate947.ConditionalRequired<[options?: ({
        id?: T_1["id"] | undefined;
        systemId?: string;
        input?: xstate947.InputFrom<T_1["logic"]> | undefined;
        syncSnapshot?: boolean;
      } & { [K_1 in xstate947.RequiredActorOptions<T_1>]: unknown }) | undefined], xstate947.IsNotNever<xstate947.RequiredActorOptions<T_1>>> : never : never : never) | ({
        src: "server-sent events";
        logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
          listener: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
          id: string;
        }, xstate947.EventObject>;
        id: string | undefined;
      } extends infer T_2 ? T_2 extends {
        src: "server-sent events";
        logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
          listener: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
          id: string;
        }, xstate947.EventObject>;
        id: string | undefined;
      } ? T_2 extends {
        src: TSrc;
      } ? xstate947.ConditionalRequired<[options?: ({
        id?: T_2["id"] | undefined;
        systemId?: string;
        input?: xstate947.InputFrom<T_2["logic"]> | undefined;
        syncSnapshot?: boolean;
      } & { [K_2 in xstate947.RequiredActorOptions<T_2>]: unknown }) | undefined], xstate947.IsNotNever<xstate947.RequiredActorOptions<T_2>>> : never : never : never)): xstate947.ActorRefFromLogic<xstate947.GetConcreteByKey<xstate947.Values<{
        "fetch remote snapshot": {
          src: "fetch remote snapshot";
          logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
            client: SanityClient;
            id: string;
          }, xstate947.EventObject>;
          id: "getDocument";
        };
        "submit mutations as transactions": {
          src: "submit mutations as transactions";
          logic: xstate947.PromiseActorLogic<void, {
            client: SanityClient;
            transactions: _sanity_mutate__unstable_machine296.Transaction[];
          }, xstate947.EventObject>;
          id: "submitTransactions";
        };
        "server-sent events": {
          src: "server-sent events";
          logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
            listener: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
            id: string;
          }, xstate947.EventObject>;
          id: string | undefined;
        };
      }>, "src", TSrc>["logic"]>;
      <TLogic extends xstate947.AnyActorLogic>(src: TLogic, options?: {
        id?: never;
        systemId?: string;
        input?: xstate947.InputFrom<TLogic> | undefined;
        syncSnapshot?: boolean;
      } | undefined): xstate947.ActorRefFromLogic<TLogic>;
    };
    input: _sanity_mutate__unstable_machine296.DocumentMutatorMachineInput;
    self: xstate947.ActorRef<xstate947.MachineSnapshot<{
      client: SanityClient;
      sharedListener?: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
      id: string;
      cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
      remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
      local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
      mutationEvents: _sanity_client764.MutationEvent[];
      stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
      stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
      error: unknown;
      fetchRemoteSnapshotAttempts: number;
      submitTransactionsAttempts: number;
    }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
      type: "error";
    } | {
      type: "retry";
    } | {
      type: "connect";
    } | {
      type: "reconnect";
    } | {
      type: "welcome";
    } | {
      type: "mutate";
      mutations: _sanity_mutate__unstable_machine296.Mutation[];
    } | {
      type: "submit";
    } | {
      type: "xstate.done.actor.getDocument";
      output: _sanity_client764.SanityDocument<DocumentType>;
    } | {
      type: "xstate.done.actor.submitTransactions";
      output: undefined;
    }, Record<string, xstate947.AnyActorRef | undefined>, xstate947.StateValue, string, unknown, any, any>, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
      type: "error";
    } | {
      type: "retry";
    } | {
      type: "connect";
    } | {
      type: "reconnect";
    } | {
      type: "welcome";
    } | {
      type: "mutate";
      mutations: _sanity_mutate__unstable_machine296.Mutation[];
    } | {
      type: "submit";
    } | {
      type: "xstate.done.actor.getDocument";
      output: _sanity_client764.SanityDocument<DocumentType>;
    } | {
      type: "xstate.done.actor.submitTransactions";
      output: undefined;
    }, xstate947.AnyEventObject>;
  }) => {
    client: SanityClient;
    sharedListener: rxjs8.Observable<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent> | undefined;
    id: string;
    remote: undefined;
    local: undefined;
    mutationEvents: never[];
    stagedChanges: never[];
    stashedChanges: never[];
    error: undefined;
    fetchRemoteSnapshotAttempts: number;
    submitTransactionsAttempts: number;
    cache: Map<string, _sanity_client764.SanityDocument<DocumentType> | null> | undefined;
  };
  readonly entry: readonly ["connect to server-sent events"];
  readonly on: {
    readonly mutate: {
      readonly actions: readonly ["rebase local snapshot", "stage mutation"];
    };
  };
  readonly initial: "disconnected";
  readonly states: {
    readonly disconnected: {
      readonly on: {
        readonly connect: {
          readonly target: "connecting";
          readonly actions: readonly ["listen to server-sent events"];
        };
      };
    };
    readonly connecting: {
      readonly on: {
        readonly welcome: "connected";
        readonly reconnect: "reconnecting";
        readonly error: "connectFailure";
      };
      readonly tags: readonly ["busy"];
    };
    readonly connectFailure: {
      readonly on: {
        readonly connect: {
          readonly target: "connecting";
          readonly actions: readonly ["listen to server-sent events"];
        };
      };
      readonly entry: readonly ["stop listening to server-sent events", "assign error to context"];
      readonly exit: readonly ["clear error from context"];
      readonly tags: readonly ["error"];
    };
    readonly reconnecting: {
      readonly on: {
        readonly welcome: {
          readonly target: "connected";
        };
        readonly error: {
          readonly target: "connectFailure";
        };
      };
      readonly tags: readonly ["busy", "error"];
    };
    readonly connected: {
      readonly on: {
        readonly mutation: {
          readonly actions: readonly ["buffer remote mutation events"];
        };
        readonly reconnect: "reconnecting";
      };
      readonly entry: readonly ["clear error from context"];
      readonly initial: "loading";
      readonly states: {
        readonly loading: {
          readonly invoke: {
            readonly src: "fetch remote snapshot";
            readonly id: "getDocument";
            readonly input: ({
              context
            }: {
              context: {
                client: SanityClient;
                sharedListener?: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
                id: string;
                cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                mutationEvents: _sanity_client764.MutationEvent[];
                stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                error: unknown;
                fetchRemoteSnapshotAttempts: number;
                submitTransactionsAttempts: number;
              };
              event: _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                type: "error";
              } | {
                type: "retry";
              } | {
                type: "connect";
              } | {
                type: "reconnect";
              } | {
                type: "welcome";
              } | {
                type: "mutate";
                mutations: _sanity_mutate__unstable_machine296.Mutation[];
              } | {
                type: "submit";
              } | {
                type: "xstate.done.actor.getDocument";
                output: _sanity_client764.SanityDocument<DocumentType>;
              } | {
                type: "xstate.done.actor.submitTransactions";
                output: undefined;
              };
              self: xstate947.ActorRef<xstate947.MachineSnapshot<{
                client: SanityClient;
                sharedListener?: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
                id: string;
                cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                mutationEvents: _sanity_client764.MutationEvent[];
                stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                error: unknown;
                fetchRemoteSnapshotAttempts: number;
                submitTransactionsAttempts: number;
              }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                type: "error";
              } | {
                type: "retry";
              } | {
                type: "connect";
              } | {
                type: "reconnect";
              } | {
                type: "welcome";
              } | {
                type: "mutate";
                mutations: _sanity_mutate__unstable_machine296.Mutation[];
              } | {
                type: "submit";
              } | {
                type: "xstate.done.actor.getDocument";
                output: _sanity_client764.SanityDocument<DocumentType>;
              } | {
                type: "xstate.done.actor.submitTransactions";
                output: undefined;
              }, Record<string, xstate947.AnyActorRef>, xstate947.StateValue, string, unknown, any, any>, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                type: "error";
              } | {
                type: "retry";
              } | {
                type: "connect";
              } | {
                type: "reconnect";
              } | {
                type: "welcome";
              } | {
                type: "mutate";
                mutations: _sanity_mutate__unstable_machine296.Mutation[];
              } | {
                type: "submit";
              } | {
                type: "xstate.done.actor.getDocument";
                output: _sanity_client764.SanityDocument<DocumentType>;
              } | {
                type: "xstate.done.actor.submitTransactions";
                output: undefined;
              }, xstate947.AnyEventObject>;
            }) => {
              client: SanityClient;
              id: string;
            };
            readonly onError: {
              readonly target: "loadFailure";
            };
            readonly onDone: {
              readonly target: "loaded";
              readonly actions: readonly ["rebase fetched remote snapshot", "reset fetch attempts"];
            };
          };
          readonly tags: readonly ["busy"];
        };
        readonly loaded: {
          readonly entry: readonly ["send sync event to parent"];
          readonly on: {
            readonly mutation: {
              readonly actions: readonly ["apply mendoza patch", "send mutation event to parent"];
            };
          };
          readonly initial: "pristine";
          readonly states: {
            readonly pristine: {
              readonly on: {
                readonly mutate: {
                  readonly actions: readonly ["rebase local snapshot", "stage mutation"];
                  readonly target: "dirty";
                };
              };
              readonly tags: readonly ["ready"];
            };
            readonly dirty: {
              readonly on: {
                readonly submit: "submitting";
              };
              readonly tags: readonly ["ready"];
            };
            readonly submitting: {
              readonly on: {
                readonly mutate: {
                  readonly actions: readonly ["rebase local snapshot", "stash mutation"];
                };
              };
              readonly invoke: {
                readonly src: "submit mutations as transactions";
                readonly id: "submitTransactions";
                readonly input: ({
                  context
                }: {
                  context: {
                    client: SanityClient;
                    sharedListener?: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
                    id: string;
                    cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                    remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                    local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                    mutationEvents: _sanity_client764.MutationEvent[];
                    stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                    stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                    error: unknown;
                    fetchRemoteSnapshotAttempts: number;
                    submitTransactionsAttempts: number;
                  };
                  event: _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                    type: "error";
                  } | {
                    type: "retry";
                  } | {
                    type: "connect";
                  } | {
                    type: "reconnect";
                  } | {
                    type: "welcome";
                  } | {
                    type: "mutate";
                    mutations: _sanity_mutate__unstable_machine296.Mutation[];
                  } | {
                    type: "submit";
                  } | {
                    type: "xstate.done.actor.getDocument";
                    output: _sanity_client764.SanityDocument<DocumentType>;
                  } | {
                    type: "xstate.done.actor.submitTransactions";
                    output: undefined;
                  };
                  self: xstate947.ActorRef<xstate947.MachineSnapshot<{
                    client: SanityClient;
                    sharedListener?: ReturnType<typeof _sanity_mutate__unstable_machine296.createSharedListener>;
                    id: string;
                    cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                    remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                    local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                    mutationEvents: _sanity_client764.MutationEvent[];
                    stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                    stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                    error: unknown;
                    fetchRemoteSnapshotAttempts: number;
                    submitTransactionsAttempts: number;
                  }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                    type: "error";
                  } | {
                    type: "retry";
                  } | {
                    type: "connect";
                  } | {
                    type: "reconnect";
                  } | {
                    type: "welcome";
                  } | {
                    type: "mutate";
                    mutations: _sanity_mutate__unstable_machine296.Mutation[];
                  } | {
                    type: "submit";
                  } | {
                    type: "xstate.done.actor.getDocument";
                    output: _sanity_client764.SanityDocument<DocumentType>;
                  } | {
                    type: "xstate.done.actor.submitTransactions";
                    output: undefined;
                  }, Record<string, xstate947.AnyActorRef>, xstate947.StateValue, string, unknown, any, any>, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                    type: "error";
                  } | {
                    type: "retry";
                  } | {
                    type: "connect";
                  } | {
                    type: "reconnect";
                  } | {
                    type: "welcome";
                  } | {
                    type: "mutate";
                    mutations: _sanity_mutate__unstable_machine296.Mutation[];
                  } | {
                    type: "submit";
                  } | {
                    type: "xstate.done.actor.getDocument";
                    output: _sanity_client764.SanityDocument<DocumentType>;
                  } | {
                    type: "xstate.done.actor.submitTransactions";
                    output: undefined;
                  }, xstate947.AnyEventObject>;
                }) => {
                  client: SanityClient;
                  transactions: _sanity_mutate__unstable_machine296.Transaction[];
                };
                readonly onError: {
                  readonly target: "submitFailure";
                };
                readonly onDone: {
                  readonly target: "pristine";
                  readonly actions: readonly ["restore stashed changes", "reset submit attempts", "send pristine event to parent"];
                };
              };
              readonly tags: readonly ["busy", "ready"];
            };
            readonly submitFailure: {
              readonly exit: readonly ["clear error from context"];
              readonly after: {
                readonly submitTransactionsTimeout: {
                  readonly actions: readonly ["increment submit attempts"];
                  readonly target: "submitting";
                };
              };
              readonly on: {
                readonly retry: "submitting";
              };
              readonly tags: readonly ["error", "ready"];
            };
          };
        };
        readonly loadFailure: {
          readonly exit: readonly ["clear error from context"];
          readonly after: {
            readonly fetchRemoteSnapshotTimeout: {
              readonly actions: readonly ["increment fetch attempts"];
              readonly target: "loading";
            };
          };
          readonly on: {
            readonly retry: "loading";
          };
          readonly tags: readonly ["error"];
        };
      };
    };
  };
}>;
interface DatasetMutatorMachineInput extends Omit<DocumentMutatorMachineInput, 'id'> {
  client: SanityClient;
  /** A shared listener can be provided, if not it'll be created using `client.listen()` */
  sharedListener?: ReturnType<typeof createSharedListener>;
}
declare const createDatasetMutator: (comlink: VisualEditingNode) => xstate947.StateMachine<{
  client: SanityClient;
  /** A shared listener can be provided, if not it'll be created using `client.listen()` */
  sharedListener?: ReturnType<typeof createSharedListener>;
  documents: Record<string, ActorRefFrom<ReturnType<typeof createDocumentMutator>>>;
}, {
  type: "sync";
  id: string;
  document: _sanity_mutate__unstable_machine296.SanityDocumentBase;
} | {
  type: "mutation";
  id: string;
  effects: {
    apply: _sanity_mutate__unstable_machine296.RawPatch;
  };
  previousRev: string;
  resultRev: string;
} | {
  type: "rebased.local";
  id: string;
  document: _sanity_mutate__unstable_machine296.SanityDocumentBase;
} | {
  type: "rebased.remote";
  id: string;
  document: _sanity_mutate__unstable_machine296.SanityDocumentBase;
} | {
  type: "pristine";
  id: string;
} | {
  type: "observe";
  documentId: string;
} | {
  type: "unobserve";
  documentId: string;
} | {
  type: "add document actor";
  documentId: string;
} | {
  type: "stop document actor";
  documentId: string;
}, {
  [x: string]: xstate947.ActorRefFromLogic<xstate947.StateMachine<{
    client: SanityClient;
    sharedListener?: ReturnType<typeof createSharedListener>;
    id: string;
    cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
    remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
    local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
    mutationEvents: _sanity_client764.MutationEvent[];
    stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
    stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
    error: unknown;
    fetchRemoteSnapshotAttempts: number;
    submitTransactionsAttempts: number;
  }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
    type: "error";
  } | {
    type: "retry";
  } | {
    type: "connect";
  } | {
    type: "reconnect";
  } | {
    type: "welcome";
  } | {
    type: "mutate";
    mutations: _sanity_mutate__unstable_machine296.Mutation[];
  } | {
    type: "submit";
  } | {
    type: "xstate.done.actor.getDocument";
    output: _sanity_client764.SanityDocument<DocumentType>;
  } | {
    type: "xstate.done.actor.submitTransactions";
    output: undefined;
  }, {
    [x: string]: xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
      client: SanityClient;
      id: string;
    }, xstate947.EventObject>> | xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void, {
      client: SanityClient;
      transactions: _sanity_mutate__unstable_machine296.Transaction[];
    }, xstate947.EventObject>> | xstate947.ActorRefFromLogic<xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
      listener: ReturnType<typeof createSharedListener>;
      id: string;
    }, xstate947.EventObject>> | undefined;
    getDocument?: xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
      client: SanityClient;
      id: string;
    }, xstate947.EventObject>> | undefined;
    submitTransactions?: xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void, {
      client: SanityClient;
      transactions: _sanity_mutate__unstable_machine296.Transaction[];
    }, xstate947.EventObject>> | undefined;
  }, xstate947.Values<{
    'fetch remote snapshot': {
      src: "fetch remote snapshot";
      logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
        client: SanityClient;
        id: string;
      }, xstate947.EventObject>;
      id: "getDocument";
    };
    'submit mutations as transactions': {
      src: "submit mutations as transactions";
      logic: xstate947.PromiseActorLogic<void, {
        client: SanityClient;
        transactions: _sanity_mutate__unstable_machine296.Transaction[];
      }, xstate947.EventObject>;
      id: "submitTransactions";
    };
    'server-sent events': {
      src: "server-sent events";
      logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
        listener: ReturnType<typeof createSharedListener>;
        id: string;
      }, xstate947.EventObject>;
      id: string | undefined;
    };
  }>, xstate947.Values<{
    'assign error to context': {
      type: "assign error to context";
      params: xstate947.NonReducibleUnknown;
    };
    'clear error from context': {
      type: "clear error from context";
      params: xstate947.NonReducibleUnknown;
    };
    'connect to server-sent events': {
      type: "connect to server-sent events";
      params: xstate947.NonReducibleUnknown;
    };
    'listen to server-sent events': {
      type: "listen to server-sent events";
      params: xstate947.NonReducibleUnknown;
    };
    'stop listening to server-sent events': {
      type: "stop listening to server-sent events";
      params: xstate947.NonReducibleUnknown;
    };
    'buffer remote mutation events': {
      type: "buffer remote mutation events";
      params: xstate947.NonReducibleUnknown;
    };
    'restore stashed changes': {
      type: "restore stashed changes";
      params: xstate947.NonReducibleUnknown;
    };
    'rebase fetched remote snapshot': {
      type: "rebase fetched remote snapshot";
      params: xstate947.NonReducibleUnknown;
    };
    'apply mendoza patch': {
      type: "apply mendoza patch";
      params: xstate947.NonReducibleUnknown;
    };
    'increment fetch attempts': {
      type: "increment fetch attempts";
      params: xstate947.NonReducibleUnknown;
    };
    'reset fetch attempts': {
      type: "reset fetch attempts";
      params: xstate947.NonReducibleUnknown;
    };
    'increment submit attempts': {
      type: "increment submit attempts";
      params: xstate947.NonReducibleUnknown;
    };
    'reset submit attempts': {
      type: "reset submit attempts";
      params: xstate947.NonReducibleUnknown;
    };
    'stage mutation': {
      type: "stage mutation";
      params: xstate947.NonReducibleUnknown;
    };
    'stash mutation': {
      type: "stash mutation";
      params: xstate947.NonReducibleUnknown;
    };
    'rebase local snapshot': {
      type: "rebase local snapshot";
      params: xstate947.NonReducibleUnknown;
    };
    'send pristine event to parent': {
      type: "send pristine event to parent";
      params: xstate947.NonReducibleUnknown;
    };
    'send sync event to parent': {
      type: "send sync event to parent";
      params: xstate947.NonReducibleUnknown;
    };
    'send mutation event to parent': {
      type: "send mutation event to parent";
      params: xstate947.NonReducibleUnknown;
    };
  }>, never, "fetchRemoteSnapshotTimeout" | "submitTransactionsTimeout", "disconnected" | "connecting" | "reconnecting" | "connectFailure" | {
    connected: "loading" | "loadFailure" | {
      loaded: "pristine" | "dirty" | "submitting" | "submitFailure";
    };
  }, "error" | "busy" | "ready", DocumentMutatorMachineInput, xstate947.NonReducibleUnknown, xstate947.EventObject, xstate947.MetaObject, {
    readonly id: "document-mutator";
    readonly context: ({
      input
    }: {
      spawn: {
        <TSrc extends "fetch remote snapshot" | "submit mutations as transactions" | "server-sent events">(logic: TSrc, ...[options]: ({
          src: "fetch remote snapshot";
          logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
            client: SanityClient;
            id: string;
          }, xstate947.EventObject>;
          id: "getDocument";
        } extends infer T ? T extends {
          src: "fetch remote snapshot";
          logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
            client: SanityClient;
            id: string;
          }, xstate947.EventObject>;
          id: "getDocument";
        } ? T extends {
          src: TSrc;
        } ? xstate947.ConditionalRequired<[options?: ({
          id?: T["id"] | undefined;
          systemId?: string;
          input?: xstate947.InputFrom<T["logic"]> | undefined;
          syncSnapshot?: boolean;
        } & { [K in xstate947.RequiredActorOptions<T>]: unknown }) | undefined], xstate947.IsNotNever<xstate947.RequiredActorOptions<T>>> : never : never : never) | ({
          src: "submit mutations as transactions";
          logic: xstate947.PromiseActorLogic<void, {
            client: SanityClient;
            transactions: _sanity_mutate__unstable_machine296.Transaction[];
          }, xstate947.EventObject>;
          id: "submitTransactions";
        } extends infer T_1 ? T_1 extends {
          src: "submit mutations as transactions";
          logic: xstate947.PromiseActorLogic<void, {
            client: SanityClient;
            transactions: _sanity_mutate__unstable_machine296.Transaction[];
          }, xstate947.EventObject>;
          id: "submitTransactions";
        } ? T_1 extends {
          src: TSrc;
        } ? xstate947.ConditionalRequired<[options?: ({
          id?: T_1["id"] | undefined;
          systemId?: string;
          input?: xstate947.InputFrom<T_1["logic"]> | undefined;
          syncSnapshot?: boolean;
        } & { [K_1 in xstate947.RequiredActorOptions<T_1>]: unknown }) | undefined], xstate947.IsNotNever<xstate947.RequiredActorOptions<T_1>>> : never : never : never) | ({
          src: "server-sent events";
          logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
            listener: ReturnType<typeof createSharedListener>;
            id: string;
          }, xstate947.EventObject>;
          id: string | undefined;
        } extends infer T_2 ? T_2 extends {
          src: "server-sent events";
          logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
            listener: ReturnType<typeof createSharedListener>;
            id: string;
          }, xstate947.EventObject>;
          id: string | undefined;
        } ? T_2 extends {
          src: TSrc;
        } ? xstate947.ConditionalRequired<[options?: ({
          id?: T_2["id"] | undefined;
          systemId?: string;
          input?: xstate947.InputFrom<T_2["logic"]> | undefined;
          syncSnapshot?: boolean;
        } & { [K_2 in xstate947.RequiredActorOptions<T_2>]: unknown }) | undefined], xstate947.IsNotNever<xstate947.RequiredActorOptions<T_2>>> : never : never : never)): xstate947.ActorRefFromLogic<xstate947.GetConcreteByKey<xstate947.Values<{
          "fetch remote snapshot": {
            src: "fetch remote snapshot";
            logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
              client: SanityClient;
              id: string;
            }, xstate947.EventObject>;
            id: "getDocument";
          };
          "submit mutations as transactions": {
            src: "submit mutations as transactions";
            logic: xstate947.PromiseActorLogic<void, {
              client: SanityClient;
              transactions: _sanity_mutate__unstable_machine296.Transaction[];
            }, xstate947.EventObject>;
            id: "submitTransactions";
          };
          "server-sent events": {
            src: "server-sent events";
            logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
              listener: ReturnType<typeof createSharedListener>;
              id: string;
            }, xstate947.EventObject>;
            id: string | undefined;
          };
        }>, "src", TSrc>["logic"]>;
        <TLogic extends xstate947.AnyActorLogic>(src: TLogic, options?: {
          id?: never;
          systemId?: string;
          input?: xstate947.InputFrom<TLogic> | undefined;
          syncSnapshot?: boolean;
        } | undefined): xstate947.ActorRefFromLogic<TLogic>;
      };
      input: DocumentMutatorMachineInput;
      self: xstate947.ActorRef<xstate947.MachineSnapshot<{
        client: SanityClient;
        sharedListener?: ReturnType<typeof createSharedListener>;
        id: string;
        cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
        remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
        local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
        mutationEvents: _sanity_client764.MutationEvent[];
        stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
        stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
        error: unknown;
        fetchRemoteSnapshotAttempts: number;
        submitTransactionsAttempts: number;
      }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
        type: "error";
      } | {
        type: "retry";
      } | {
        type: "connect";
      } | {
        type: "reconnect";
      } | {
        type: "welcome";
      } | {
        type: "mutate";
        mutations: _sanity_mutate__unstable_machine296.Mutation[];
      } | {
        type: "submit";
      } | {
        type: "xstate.done.actor.getDocument";
        output: _sanity_client764.SanityDocument<DocumentType>;
      } | {
        type: "xstate.done.actor.submitTransactions";
        output: undefined;
      }, Record<string, xstate947.AnyActorRef | undefined>, xstate947.StateValue, string, unknown, any, any>, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
        type: "error";
      } | {
        type: "retry";
      } | {
        type: "connect";
      } | {
        type: "reconnect";
      } | {
        type: "welcome";
      } | {
        type: "mutate";
        mutations: _sanity_mutate__unstable_machine296.Mutation[];
      } | {
        type: "submit";
      } | {
        type: "xstate.done.actor.getDocument";
        output: _sanity_client764.SanityDocument<DocumentType>;
      } | {
        type: "xstate.done.actor.submitTransactions";
        output: undefined;
      }, xstate947.AnyEventObject>;
    }) => {
      client: SanityClient;
      sharedListener: rxjs8.Observable<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent> | undefined;
      id: string;
      remote: undefined;
      local: undefined;
      mutationEvents: never[];
      stagedChanges: never[];
      stashedChanges: never[];
      error: undefined;
      fetchRemoteSnapshotAttempts: number;
      submitTransactionsAttempts: number;
      cache: Map<string, _sanity_client764.SanityDocument<DocumentType> | null> | undefined;
    };
    readonly entry: readonly ["connect to server-sent events"];
    readonly on: {
      readonly mutate: {
        readonly actions: readonly ["rebase local snapshot", "stage mutation"];
      };
    };
    readonly initial: "disconnected";
    readonly states: {
      readonly disconnected: {
        readonly on: {
          readonly connect: {
            readonly target: "connecting";
            readonly actions: readonly ["listen to server-sent events"];
          };
        };
      };
      readonly connecting: {
        readonly on: {
          readonly welcome: "connected";
          readonly reconnect: "reconnecting";
          readonly error: "connectFailure";
        };
        readonly tags: readonly ["busy"];
      };
      readonly connectFailure: {
        readonly on: {
          readonly connect: {
            readonly target: "connecting";
            readonly actions: readonly ["listen to server-sent events"];
          };
        };
        readonly entry: readonly ["stop listening to server-sent events", "assign error to context"];
        readonly exit: readonly ["clear error from context"];
        readonly tags: readonly ["error"];
      };
      readonly reconnecting: {
        readonly on: {
          readonly welcome: {
            readonly target: "connected";
          };
          readonly error: {
            readonly target: "connectFailure";
          };
        };
        readonly tags: readonly ["busy", "error"];
      };
      readonly connected: {
        readonly on: {
          readonly mutation: {
            readonly actions: readonly ["buffer remote mutation events"];
          };
          readonly reconnect: "reconnecting";
        };
        readonly entry: readonly ["clear error from context"];
        readonly initial: "loading";
        readonly states: {
          readonly loading: {
            readonly invoke: {
              readonly src: "fetch remote snapshot";
              readonly id: "getDocument";
              readonly input: ({
                context
              }: {
                context: {
                  client: SanityClient;
                  sharedListener?: ReturnType<typeof createSharedListener>;
                  id: string;
                  cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                  remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                  local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                  mutationEvents: _sanity_client764.MutationEvent[];
                  stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                  stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                  error: unknown;
                  fetchRemoteSnapshotAttempts: number;
                  submitTransactionsAttempts: number;
                };
                event: _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                  type: "error";
                } | {
                  type: "retry";
                } | {
                  type: "connect";
                } | {
                  type: "reconnect";
                } | {
                  type: "welcome";
                } | {
                  type: "mutate";
                  mutations: _sanity_mutate__unstable_machine296.Mutation[];
                } | {
                  type: "submit";
                } | {
                  type: "xstate.done.actor.getDocument";
                  output: _sanity_client764.SanityDocument<DocumentType>;
                } | {
                  type: "xstate.done.actor.submitTransactions";
                  output: undefined;
                };
                self: xstate947.ActorRef<xstate947.MachineSnapshot<{
                  client: SanityClient;
                  sharedListener?: ReturnType<typeof createSharedListener>;
                  id: string;
                  cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                  remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                  local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                  mutationEvents: _sanity_client764.MutationEvent[];
                  stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                  stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                  error: unknown;
                  fetchRemoteSnapshotAttempts: number;
                  submitTransactionsAttempts: number;
                }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                  type: "error";
                } | {
                  type: "retry";
                } | {
                  type: "connect";
                } | {
                  type: "reconnect";
                } | {
                  type: "welcome";
                } | {
                  type: "mutate";
                  mutations: _sanity_mutate__unstable_machine296.Mutation[];
                } | {
                  type: "submit";
                } | {
                  type: "xstate.done.actor.getDocument";
                  output: _sanity_client764.SanityDocument<DocumentType>;
                } | {
                  type: "xstate.done.actor.submitTransactions";
                  output: undefined;
                }, Record<string, xstate947.AnyActorRef>, xstate947.StateValue, string, unknown, any, any>, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                  type: "error";
                } | {
                  type: "retry";
                } | {
                  type: "connect";
                } | {
                  type: "reconnect";
                } | {
                  type: "welcome";
                } | {
                  type: "mutate";
                  mutations: _sanity_mutate__unstable_machine296.Mutation[];
                } | {
                  type: "submit";
                } | {
                  type: "xstate.done.actor.getDocument";
                  output: _sanity_client764.SanityDocument<DocumentType>;
                } | {
                  type: "xstate.done.actor.submitTransactions";
                  output: undefined;
                }, xstate947.AnyEventObject>;
              }) => {
                client: SanityClient;
                id: string;
              };
              readonly onError: {
                readonly target: "loadFailure";
              };
              readonly onDone: {
                readonly target: "loaded";
                readonly actions: readonly ["rebase fetched remote snapshot", "reset fetch attempts"];
              };
            };
            readonly tags: readonly ["busy"];
          };
          readonly loaded: {
            readonly entry: readonly ["send sync event to parent"];
            readonly on: {
              readonly mutation: {
                readonly actions: readonly ["apply mendoza patch", "send mutation event to parent"];
              };
            };
            readonly initial: "pristine";
            readonly states: {
              readonly pristine: {
                readonly on: {
                  readonly mutate: {
                    readonly actions: readonly ["rebase local snapshot", "stage mutation"];
                    readonly target: "dirty";
                  };
                };
                readonly tags: readonly ["ready"];
              };
              readonly dirty: {
                readonly on: {
                  readonly submit: "submitting";
                };
                readonly tags: readonly ["ready"];
              };
              readonly submitting: {
                readonly on: {
                  readonly mutate: {
                    readonly actions: readonly ["rebase local snapshot", "stash mutation"];
                  };
                };
                readonly invoke: {
                  readonly src: "submit mutations as transactions";
                  readonly id: "submitTransactions";
                  readonly input: ({
                    context
                  }: {
                    context: {
                      client: SanityClient;
                      sharedListener?: ReturnType<typeof createSharedListener>;
                      id: string;
                      cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                      remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                      local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                      mutationEvents: _sanity_client764.MutationEvent[];
                      stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                      stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                      error: unknown;
                      fetchRemoteSnapshotAttempts: number;
                      submitTransactionsAttempts: number;
                    };
                    event: _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                      type: "error";
                    } | {
                      type: "retry";
                    } | {
                      type: "connect";
                    } | {
                      type: "reconnect";
                    } | {
                      type: "welcome";
                    } | {
                      type: "mutate";
                      mutations: _sanity_mutate__unstable_machine296.Mutation[];
                    } | {
                      type: "submit";
                    } | {
                      type: "xstate.done.actor.getDocument";
                      output: _sanity_client764.SanityDocument<DocumentType>;
                    } | {
                      type: "xstate.done.actor.submitTransactions";
                      output: undefined;
                    };
                    self: xstate947.ActorRef<xstate947.MachineSnapshot<{
                      client: SanityClient;
                      sharedListener?: ReturnType<typeof createSharedListener>;
                      id: string;
                      cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                      remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                      local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                      mutationEvents: _sanity_client764.MutationEvent[];
                      stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                      stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                      error: unknown;
                      fetchRemoteSnapshotAttempts: number;
                      submitTransactionsAttempts: number;
                    }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                      type: "error";
                    } | {
                      type: "retry";
                    } | {
                      type: "connect";
                    } | {
                      type: "reconnect";
                    } | {
                      type: "welcome";
                    } | {
                      type: "mutate";
                      mutations: _sanity_mutate__unstable_machine296.Mutation[];
                    } | {
                      type: "submit";
                    } | {
                      type: "xstate.done.actor.getDocument";
                      output: _sanity_client764.SanityDocument<DocumentType>;
                    } | {
                      type: "xstate.done.actor.submitTransactions";
                      output: undefined;
                    }, Record<string, xstate947.AnyActorRef>, xstate947.StateValue, string, unknown, any, any>, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                      type: "error";
                    } | {
                      type: "retry";
                    } | {
                      type: "connect";
                    } | {
                      type: "reconnect";
                    } | {
                      type: "welcome";
                    } | {
                      type: "mutate";
                      mutations: _sanity_mutate__unstable_machine296.Mutation[];
                    } | {
                      type: "submit";
                    } | {
                      type: "xstate.done.actor.getDocument";
                      output: _sanity_client764.SanityDocument<DocumentType>;
                    } | {
                      type: "xstate.done.actor.submitTransactions";
                      output: undefined;
                    }, xstate947.AnyEventObject>;
                  }) => {
                    client: SanityClient;
                    transactions: _sanity_mutate__unstable_machine296.Transaction[];
                  };
                  readonly onError: {
                    readonly target: "submitFailure";
                  };
                  readonly onDone: {
                    readonly target: "pristine";
                    readonly actions: readonly ["restore stashed changes", "reset submit attempts", "send pristine event to parent"];
                  };
                };
                readonly tags: readonly ["busy", "ready"];
              };
              readonly submitFailure: {
                readonly exit: readonly ["clear error from context"];
                readonly after: {
                  readonly submitTransactionsTimeout: {
                    readonly actions: readonly ["increment submit attempts"];
                    readonly target: "submitting";
                  };
                };
                readonly on: {
                  readonly retry: "submitting";
                };
                readonly tags: readonly ["error", "ready"];
              };
            };
          };
          readonly loadFailure: {
            readonly exit: readonly ["clear error from context"];
            readonly after: {
              readonly fetchRemoteSnapshotTimeout: {
                readonly actions: readonly ["increment fetch attempts"];
                readonly target: "loading";
              };
            };
            readonly on: {
              readonly retry: "loading";
            };
            readonly tags: readonly ["error"];
          };
        };
      };
    };
  }>> | undefined;
}, {
  src: "documentMutatorMachine";
  logic: xstate947.StateMachine<{
    client: SanityClient;
    sharedListener?: ReturnType<typeof createSharedListener>;
    id: string;
    cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
    remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
    local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
    mutationEvents: _sanity_client764.MutationEvent[];
    stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
    stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
    error: unknown;
    fetchRemoteSnapshotAttempts: number;
    submitTransactionsAttempts: number;
  }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
    type: "error";
  } | {
    type: "retry";
  } | {
    type: "connect";
  } | {
    type: "reconnect";
  } | {
    type: "welcome";
  } | {
    type: "mutate";
    mutations: _sanity_mutate__unstable_machine296.Mutation[];
  } | {
    type: "submit";
  } | {
    type: "xstate.done.actor.getDocument";
    output: _sanity_client764.SanityDocument<DocumentType>;
  } | {
    type: "xstate.done.actor.submitTransactions";
    output: undefined;
  }, {
    [x: string]: xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
      client: SanityClient;
      id: string;
    }, xstate947.EventObject>> | xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void, {
      client: SanityClient;
      transactions: _sanity_mutate__unstable_machine296.Transaction[];
    }, xstate947.EventObject>> | xstate947.ActorRefFromLogic<xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
      listener: ReturnType<typeof createSharedListener>;
      id: string;
    }, xstate947.EventObject>> | undefined;
    getDocument?: xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
      client: SanityClient;
      id: string;
    }, xstate947.EventObject>> | undefined;
    submitTransactions?: xstate947.ActorRefFromLogic<xstate947.PromiseActorLogic<void, {
      client: SanityClient;
      transactions: _sanity_mutate__unstable_machine296.Transaction[];
    }, xstate947.EventObject>> | undefined;
  }, xstate947.Values<{
    'fetch remote snapshot': {
      src: "fetch remote snapshot";
      logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
        client: SanityClient;
        id: string;
      }, xstate947.EventObject>;
      id: "getDocument";
    };
    'submit mutations as transactions': {
      src: "submit mutations as transactions";
      logic: xstate947.PromiseActorLogic<void, {
        client: SanityClient;
        transactions: _sanity_mutate__unstable_machine296.Transaction[];
      }, xstate947.EventObject>;
      id: "submitTransactions";
    };
    'server-sent events': {
      src: "server-sent events";
      logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
        listener: ReturnType<typeof createSharedListener>;
        id: string;
      }, xstate947.EventObject>;
      id: string | undefined;
    };
  }>, xstate947.Values<{
    'assign error to context': {
      type: "assign error to context";
      params: xstate947.NonReducibleUnknown;
    };
    'clear error from context': {
      type: "clear error from context";
      params: xstate947.NonReducibleUnknown;
    };
    'connect to server-sent events': {
      type: "connect to server-sent events";
      params: xstate947.NonReducibleUnknown;
    };
    'listen to server-sent events': {
      type: "listen to server-sent events";
      params: xstate947.NonReducibleUnknown;
    };
    'stop listening to server-sent events': {
      type: "stop listening to server-sent events";
      params: xstate947.NonReducibleUnknown;
    };
    'buffer remote mutation events': {
      type: "buffer remote mutation events";
      params: xstate947.NonReducibleUnknown;
    };
    'restore stashed changes': {
      type: "restore stashed changes";
      params: xstate947.NonReducibleUnknown;
    };
    'rebase fetched remote snapshot': {
      type: "rebase fetched remote snapshot";
      params: xstate947.NonReducibleUnknown;
    };
    'apply mendoza patch': {
      type: "apply mendoza patch";
      params: xstate947.NonReducibleUnknown;
    };
    'increment fetch attempts': {
      type: "increment fetch attempts";
      params: xstate947.NonReducibleUnknown;
    };
    'reset fetch attempts': {
      type: "reset fetch attempts";
      params: xstate947.NonReducibleUnknown;
    };
    'increment submit attempts': {
      type: "increment submit attempts";
      params: xstate947.NonReducibleUnknown;
    };
    'reset submit attempts': {
      type: "reset submit attempts";
      params: xstate947.NonReducibleUnknown;
    };
    'stage mutation': {
      type: "stage mutation";
      params: xstate947.NonReducibleUnknown;
    };
    'stash mutation': {
      type: "stash mutation";
      params: xstate947.NonReducibleUnknown;
    };
    'rebase local snapshot': {
      type: "rebase local snapshot";
      params: xstate947.NonReducibleUnknown;
    };
    'send pristine event to parent': {
      type: "send pristine event to parent";
      params: xstate947.NonReducibleUnknown;
    };
    'send sync event to parent': {
      type: "send sync event to parent";
      params: xstate947.NonReducibleUnknown;
    };
    'send mutation event to parent': {
      type: "send mutation event to parent";
      params: xstate947.NonReducibleUnknown;
    };
  }>, never, "fetchRemoteSnapshotTimeout" | "submitTransactionsTimeout", "disconnected" | "connecting" | "reconnecting" | "connectFailure" | {
    connected: "loading" | "loadFailure" | {
      loaded: "pristine" | "dirty" | "submitting" | "submitFailure";
    };
  }, "error" | "busy" | "ready", DocumentMutatorMachineInput, xstate947.NonReducibleUnknown, xstate947.EventObject, xstate947.MetaObject, {
    readonly id: "document-mutator";
    readonly context: ({
      input
    }: {
      spawn: {
        <TSrc extends "fetch remote snapshot" | "submit mutations as transactions" | "server-sent events">(logic: TSrc, ...[options]: ({
          src: "fetch remote snapshot";
          logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
            client: SanityClient;
            id: string;
          }, xstate947.EventObject>;
          id: "getDocument";
        } extends infer T ? T extends {
          src: "fetch remote snapshot";
          logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
            client: SanityClient;
            id: string;
          }, xstate947.EventObject>;
          id: "getDocument";
        } ? T extends {
          src: TSrc;
        } ? xstate947.ConditionalRequired<[options?: ({
          id?: T["id"] | undefined;
          systemId?: string;
          input?: xstate947.InputFrom<T["logic"]> | undefined;
          syncSnapshot?: boolean;
        } & { [K in xstate947.RequiredActorOptions<T>]: unknown }) | undefined], xstate947.IsNotNever<xstate947.RequiredActorOptions<T>>> : never : never : never) | ({
          src: "submit mutations as transactions";
          logic: xstate947.PromiseActorLogic<void, {
            client: SanityClient;
            transactions: _sanity_mutate__unstable_machine296.Transaction[];
          }, xstate947.EventObject>;
          id: "submitTransactions";
        } extends infer T_1 ? T_1 extends {
          src: "submit mutations as transactions";
          logic: xstate947.PromiseActorLogic<void, {
            client: SanityClient;
            transactions: _sanity_mutate__unstable_machine296.Transaction[];
          }, xstate947.EventObject>;
          id: "submitTransactions";
        } ? T_1 extends {
          src: TSrc;
        } ? xstate947.ConditionalRequired<[options?: ({
          id?: T_1["id"] | undefined;
          systemId?: string;
          input?: xstate947.InputFrom<T_1["logic"]> | undefined;
          syncSnapshot?: boolean;
        } & { [K_1 in xstate947.RequiredActorOptions<T_1>]: unknown }) | undefined], xstate947.IsNotNever<xstate947.RequiredActorOptions<T_1>>> : never : never : never) | ({
          src: "server-sent events";
          logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
            listener: ReturnType<typeof createSharedListener>;
            id: string;
          }, xstate947.EventObject>;
          id: string | undefined;
        } extends infer T_2 ? T_2 extends {
          src: "server-sent events";
          logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
            listener: ReturnType<typeof createSharedListener>;
            id: string;
          }, xstate947.EventObject>;
          id: string | undefined;
        } ? T_2 extends {
          src: TSrc;
        } ? xstate947.ConditionalRequired<[options?: ({
          id?: T_2["id"] | undefined;
          systemId?: string;
          input?: xstate947.InputFrom<T_2["logic"]> | undefined;
          syncSnapshot?: boolean;
        } & { [K_2 in xstate947.RequiredActorOptions<T_2>]: unknown }) | undefined], xstate947.IsNotNever<xstate947.RequiredActorOptions<T_2>>> : never : never : never)): xstate947.ActorRefFromLogic<xstate947.GetConcreteByKey<xstate947.Values<{
          "fetch remote snapshot": {
            src: "fetch remote snapshot";
            logic: xstate947.PromiseActorLogic<void | _sanity_client764.SanityDocument<Record<string, any>> | undefined, {
              client: SanityClient;
              id: string;
            }, xstate947.EventObject>;
            id: "getDocument";
          };
          "submit mutations as transactions": {
            src: "submit mutations as transactions";
            logic: xstate947.PromiseActorLogic<void, {
              client: SanityClient;
              transactions: _sanity_mutate__unstable_machine296.Transaction[];
            }, xstate947.EventObject>;
            id: "submitTransactions";
          };
          "server-sent events": {
            src: "server-sent events";
            logic: xstate947.ObservableActorLogic<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent, {
              listener: ReturnType<typeof createSharedListener>;
              id: string;
            }, xstate947.EventObject>;
            id: string | undefined;
          };
        }>, "src", TSrc>["logic"]>;
        <TLogic extends xstate947.AnyActorLogic>(src: TLogic, options?: {
          id?: never;
          systemId?: string;
          input?: xstate947.InputFrom<TLogic> | undefined;
          syncSnapshot?: boolean;
        } | undefined): xstate947.ActorRefFromLogic<TLogic>;
      };
      input: DocumentMutatorMachineInput;
      self: xstate947.ActorRef<xstate947.MachineSnapshot<{
        client: SanityClient;
        sharedListener?: ReturnType<typeof createSharedListener>;
        id: string;
        cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
        remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
        local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
        mutationEvents: _sanity_client764.MutationEvent[];
        stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
        stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
        error: unknown;
        fetchRemoteSnapshotAttempts: number;
        submitTransactionsAttempts: number;
      }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
        type: "error";
      } | {
        type: "retry";
      } | {
        type: "connect";
      } | {
        type: "reconnect";
      } | {
        type: "welcome";
      } | {
        type: "mutate";
        mutations: _sanity_mutate__unstable_machine296.Mutation[];
      } | {
        type: "submit";
      } | {
        type: "xstate.done.actor.getDocument";
        output: _sanity_client764.SanityDocument<DocumentType>;
      } | {
        type: "xstate.done.actor.submitTransactions";
        output: undefined;
      }, Record<string, xstate947.AnyActorRef | undefined>, xstate947.StateValue, string, unknown, any, any>, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
        type: "error";
      } | {
        type: "retry";
      } | {
        type: "connect";
      } | {
        type: "reconnect";
      } | {
        type: "welcome";
      } | {
        type: "mutate";
        mutations: _sanity_mutate__unstable_machine296.Mutation[];
      } | {
        type: "submit";
      } | {
        type: "xstate.done.actor.getDocument";
        output: _sanity_client764.SanityDocument<DocumentType>;
      } | {
        type: "xstate.done.actor.submitTransactions";
        output: undefined;
      }, xstate947.AnyEventObject>;
    }) => {
      client: SanityClient;
      sharedListener: rxjs8.Observable<_sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent> | undefined;
      id: string;
      remote: undefined;
      local: undefined;
      mutationEvents: never[];
      stagedChanges: never[];
      stashedChanges: never[];
      error: undefined;
      fetchRemoteSnapshotAttempts: number;
      submitTransactionsAttempts: number;
      cache: Map<string, _sanity_client764.SanityDocument<DocumentType> | null> | undefined;
    };
    readonly entry: readonly ["connect to server-sent events"];
    readonly on: {
      readonly mutate: {
        readonly actions: readonly ["rebase local snapshot", "stage mutation"];
      };
    };
    readonly initial: "disconnected";
    readonly states: {
      readonly disconnected: {
        readonly on: {
          readonly connect: {
            readonly target: "connecting";
            readonly actions: readonly ["listen to server-sent events"];
          };
        };
      };
      readonly connecting: {
        readonly on: {
          readonly welcome: "connected";
          readonly reconnect: "reconnecting";
          readonly error: "connectFailure";
        };
        readonly tags: readonly ["busy"];
      };
      readonly connectFailure: {
        readonly on: {
          readonly connect: {
            readonly target: "connecting";
            readonly actions: readonly ["listen to server-sent events"];
          };
        };
        readonly entry: readonly ["stop listening to server-sent events", "assign error to context"];
        readonly exit: readonly ["clear error from context"];
        readonly tags: readonly ["error"];
      };
      readonly reconnecting: {
        readonly on: {
          readonly welcome: {
            readonly target: "connected";
          };
          readonly error: {
            readonly target: "connectFailure";
          };
        };
        readonly tags: readonly ["busy", "error"];
      };
      readonly connected: {
        readonly on: {
          readonly mutation: {
            readonly actions: readonly ["buffer remote mutation events"];
          };
          readonly reconnect: "reconnecting";
        };
        readonly entry: readonly ["clear error from context"];
        readonly initial: "loading";
        readonly states: {
          readonly loading: {
            readonly invoke: {
              readonly src: "fetch remote snapshot";
              readonly id: "getDocument";
              readonly input: ({
                context
              }: {
                context: {
                  client: SanityClient;
                  sharedListener?: ReturnType<typeof createSharedListener>;
                  id: string;
                  cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                  remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                  local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                  mutationEvents: _sanity_client764.MutationEvent[];
                  stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                  stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                  error: unknown;
                  fetchRemoteSnapshotAttempts: number;
                  submitTransactionsAttempts: number;
                };
                event: _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                  type: "error";
                } | {
                  type: "retry";
                } | {
                  type: "connect";
                } | {
                  type: "reconnect";
                } | {
                  type: "welcome";
                } | {
                  type: "mutate";
                  mutations: _sanity_mutate__unstable_machine296.Mutation[];
                } | {
                  type: "submit";
                } | {
                  type: "xstate.done.actor.getDocument";
                  output: _sanity_client764.SanityDocument<DocumentType>;
                } | {
                  type: "xstate.done.actor.submitTransactions";
                  output: undefined;
                };
                self: xstate947.ActorRef<xstate947.MachineSnapshot<{
                  client: SanityClient;
                  sharedListener?: ReturnType<typeof createSharedListener>;
                  id: string;
                  cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                  remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                  local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                  mutationEvents: _sanity_client764.MutationEvent[];
                  stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                  stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                  error: unknown;
                  fetchRemoteSnapshotAttempts: number;
                  submitTransactionsAttempts: number;
                }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                  type: "error";
                } | {
                  type: "retry";
                } | {
                  type: "connect";
                } | {
                  type: "reconnect";
                } | {
                  type: "welcome";
                } | {
                  type: "mutate";
                  mutations: _sanity_mutate__unstable_machine296.Mutation[];
                } | {
                  type: "submit";
                } | {
                  type: "xstate.done.actor.getDocument";
                  output: _sanity_client764.SanityDocument<DocumentType>;
                } | {
                  type: "xstate.done.actor.submitTransactions";
                  output: undefined;
                }, Record<string, xstate947.AnyActorRef>, xstate947.StateValue, string, unknown, any, any>, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                  type: "error";
                } | {
                  type: "retry";
                } | {
                  type: "connect";
                } | {
                  type: "reconnect";
                } | {
                  type: "welcome";
                } | {
                  type: "mutate";
                  mutations: _sanity_mutate__unstable_machine296.Mutation[];
                } | {
                  type: "submit";
                } | {
                  type: "xstate.done.actor.getDocument";
                  output: _sanity_client764.SanityDocument<DocumentType>;
                } | {
                  type: "xstate.done.actor.submitTransactions";
                  output: undefined;
                }, xstate947.AnyEventObject>;
              }) => {
                client: SanityClient;
                id: string;
              };
              readonly onError: {
                readonly target: "loadFailure";
              };
              readonly onDone: {
                readonly target: "loaded";
                readonly actions: readonly ["rebase fetched remote snapshot", "reset fetch attempts"];
              };
            };
            readonly tags: readonly ["busy"];
          };
          readonly loaded: {
            readonly entry: readonly ["send sync event to parent"];
            readonly on: {
              readonly mutation: {
                readonly actions: readonly ["apply mendoza patch", "send mutation event to parent"];
              };
            };
            readonly initial: "pristine";
            readonly states: {
              readonly pristine: {
                readonly on: {
                  readonly mutate: {
                    readonly actions: readonly ["rebase local snapshot", "stage mutation"];
                    readonly target: "dirty";
                  };
                };
                readonly tags: readonly ["ready"];
              };
              readonly dirty: {
                readonly on: {
                  readonly submit: "submitting";
                };
                readonly tags: readonly ["ready"];
              };
              readonly submitting: {
                readonly on: {
                  readonly mutate: {
                    readonly actions: readonly ["rebase local snapshot", "stash mutation"];
                  };
                };
                readonly invoke: {
                  readonly src: "submit mutations as transactions";
                  readonly id: "submitTransactions";
                  readonly input: ({
                    context
                  }: {
                    context: {
                      client: SanityClient;
                      sharedListener?: ReturnType<typeof createSharedListener>;
                      id: string;
                      cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                      remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                      local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                      mutationEvents: _sanity_client764.MutationEvent[];
                      stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                      stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                      error: unknown;
                      fetchRemoteSnapshotAttempts: number;
                      submitTransactionsAttempts: number;
                    };
                    event: _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                      type: "error";
                    } | {
                      type: "retry";
                    } | {
                      type: "connect";
                    } | {
                      type: "reconnect";
                    } | {
                      type: "welcome";
                    } | {
                      type: "mutate";
                      mutations: _sanity_mutate__unstable_machine296.Mutation[];
                    } | {
                      type: "submit";
                    } | {
                      type: "xstate.done.actor.getDocument";
                      output: _sanity_client764.SanityDocument<DocumentType>;
                    } | {
                      type: "xstate.done.actor.submitTransactions";
                      output: undefined;
                    };
                    self: xstate947.ActorRef<xstate947.MachineSnapshot<{
                      client: SanityClient;
                      sharedListener?: ReturnType<typeof createSharedListener>;
                      id: string;
                      cache?: Map<string, _sanity_client764.SanityDocument<DocumentType> | null>;
                      remote: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                      local: _sanity_client764.SanityDocument<DocumentType> | null | undefined;
                      mutationEvents: _sanity_client764.MutationEvent[];
                      stagedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                      stashedChanges: _sanity_mutate__unstable_machine296.MutationGroup[];
                      error: unknown;
                      fetchRemoteSnapshotAttempts: number;
                      submitTransactionsAttempts: number;
                    }, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                      type: "error";
                    } | {
                      type: "retry";
                    } | {
                      type: "connect";
                    } | {
                      type: "reconnect";
                    } | {
                      type: "welcome";
                    } | {
                      type: "mutate";
                      mutations: _sanity_mutate__unstable_machine296.Mutation[];
                    } | {
                      type: "submit";
                    } | {
                      type: "xstate.done.actor.getDocument";
                      output: _sanity_client764.SanityDocument<DocumentType>;
                    } | {
                      type: "xstate.done.actor.submitTransactions";
                      output: undefined;
                    }, Record<string, xstate947.AnyActorRef>, xstate947.StateValue, string, unknown, any, any>, _sanity_client764.ReconnectEvent | _sanity_client764.WelcomeEvent | _sanity_client764.MutationEvent | {
                      type: "error";
                    } | {
                      type: "retry";
                    } | {
                      type: "connect";
                    } | {
                      type: "reconnect";
                    } | {
                      type: "welcome";
                    } | {
                      type: "mutate";
                      mutations: _sanity_mutate__unstable_machine296.Mutation[];
                    } | {
                      type: "submit";
                    } | {
                      type: "xstate.done.actor.getDocument";
                      output: _sanity_client764.SanityDocument<DocumentType>;
                    } | {
                      type: "xstate.done.actor.submitTransactions";
                      output: undefined;
                    }, xstate947.AnyEventObject>;
                  }) => {
                    client: SanityClient;
                    transactions: _sanity_mutate__unstable_machine296.Transaction[];
                  };
                  readonly onError: {
                    readonly target: "submitFailure";
                  };
                  readonly onDone: {
                    readonly target: "pristine";
                    readonly actions: readonly ["restore stashed changes", "reset submit attempts", "send pristine event to parent"];
                  };
                };
                readonly tags: readonly ["busy", "ready"];
              };
              readonly submitFailure: {
                readonly exit: readonly ["clear error from context"];
                readonly after: {
                  readonly submitTransactionsTimeout: {
                    readonly actions: readonly ["increment submit attempts"];
                    readonly target: "submitting";
                  };
                };
                readonly on: {
                  readonly retry: "submitting";
                };
                readonly tags: readonly ["error", "ready"];
              };
            };
          };
          readonly loadFailure: {
            readonly exit: readonly ["clear error from context"];
            readonly after: {
              readonly fetchRemoteSnapshotTimeout: {
                readonly actions: readonly ["increment fetch attempts"];
                readonly target: "loading";
              };
            };
            readonly on: {
              readonly retry: "loading";
            };
            readonly tags: readonly ["error"];
          };
        };
      };
    };
  }>;
  id: string | undefined;
}, {
  type: "add document actor";
  params: xstate947.NonReducibleUnknown;
} | {
  type: "emit sync event";
  params: xstate947.NonReducibleUnknown;
} | {
  type: "emit mutation event";
  params: xstate947.NonReducibleUnknown;
} | {
  type: "emit rebased event";
  params: xstate947.NonReducibleUnknown;
} | {
  type: "emit pristine event";
  params: xstate947.NonReducibleUnknown;
} | {
  type: "stop remote snapshot";
  params: xstate947.NonReducibleUnknown;
} | {
  type: "remove remote snapshot from context";
  params: xstate947.NonReducibleUnknown;
}, never, never, "pristine", string, DatasetMutatorMachineInput, xstate947.NonReducibleUnknown, {
  type: "sync";
  id: string;
  document: _sanity_mutate__unstable_machine296.SanityDocumentBase;
} | {
  type: "mutation";
  id: string;
  effects: {
    apply: _sanity_mutate__unstable_machine296.RawPatch;
  };
  previousRev: string;
  resultRev: string;
} | {
  type: "rebased.local";
  id: string;
  document: _sanity_mutate__unstable_machine296.SanityDocumentBase;
} | {
  type: "rebased.remote";
  id: string;
  document: _sanity_mutate__unstable_machine296.SanityDocumentBase;
} | {
  type: "pristine";
  id: string;
}, xstate947.MetaObject, {
  id: "dataset-mutator";
  states: {
    readonly pristine: {};
  };
}>;
type Path<T$1, K$1 extends keyof T$1> = K$1 extends string ? T$1[K$1] extends Record<string, any> ? `${K$1}.${Path<T$1[K$1], keyof T$1[K$1]>}` | K$1 : K$1 : never;
type PathValue<T$1, P extends string> = P extends `${infer K}.${infer Rest}` ? K extends keyof T$1 ? PathValue<T$1[K], Rest> : never : P extends keyof T$1 ? T$1[P] : never;
type DocumentsMutate = (documentId: string, mutations: Mutation[], options?: {
  commit?: boolean | {
    debounce: number;
  };
}) => void;
type DocumentsGet = <T$1 extends Record<string, any>>(documentId: string) => OptimisticDocument<T$1>;
type OptimisticDocumentPatches<T$1 extends Record<string, any> = Record<string, any>> = ((context: {
  draftId: string;
  publishedId: string;
  /**
   * @deprecated - use `getSnapshot` instead
   */
  snapshot: SanityDocument<T$1> | undefined;
  getSnapshot: () => Promise<SanityDocument<T$1> | null>;
}) => Promise<NodePatchList> | NodePatchList) | NodePatchList;
type OptimisticDocument<T$1 extends Record<string, any> = Record<string, any>> = {
  /**
   * The document ID
   */
  id: string;
  /**
   * Commits any locally applied mutations to the remote document
   */
  commit: () => void;
  /**
   * @deprecated - use `getSnapshot` instead
   */
  get: {
    (): SanityDocument<T$1> | undefined;
    <P extends Path<T$1, keyof T$1>>(path: P): PathValue<T$1, P> | undefined;
  };
  /**
   * Returns a promise that resolves to the current document snapshot
   */
  getSnapshot: () => Promise<SanityDocument<T$1> | null>;
  /**
   * Applies the given patches to the document
   */
  patch: (patches: OptimisticDocumentPatches<T$1>, options?: {
    commit?: boolean | {
      debounce: number;
    };
  }) => void;
};
type OptimisticReducerAction<T$1> = {
  document: T$1;
  id: string;
  originalId: string;
  type: 'appear' | 'mutate' | 'disappear';
};
type OptimisticReducer<T$1, U> = (state: T$1, action: OptimisticReducerAction<U>) => T$1;
export { OptimisticReducer as a, PathValue as c, createDocumentMutator as d, OptimisticDocumentPatches as i, DatasetMutatorMachineInput as l, DocumentsMutate as n, OptimisticReducerAction as o, OptimisticDocument as r, Path as s, DocumentsGet as t, createDatasetMutator as u };
//# sourceMappingURL=types2.d.ts.map